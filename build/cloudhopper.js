!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cloudhopper",[],t):"object"==typeof exports?exports.cloudhopper=t():e.cloudhopper=t()}(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var s=o[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),r=o(1),a=function(){function e(){n(this,e)}return i(e,[{key:"setInit",value:function(e){this.dockerInit=e}},{key:"use",value:function(e){this.router=e}},{key:"setFallback",value:function(e){console.log("setting fallback",e),console.log(this),this.fallBack=e}},{key:"handler",value:function(e,t,o){if(!e.requestContext&&!e.path)return console.log("event.url is not available, hence just executing"),void(this.fallBack?(console.log("fallback available"),this.fallBack(e,t,o)):(console.log(this),console.log("fallback not available")));var n=new r(t,o),i=e;e.requestContext&&(i={body:e.body,url:e.path,path:e.path,method:e.httpMethod,ip:e.requestContext.identity.sourceIp,headers:e.headers,protocol:"https",query:e.queryStringParameters}),""!==i.body&&"object"!==s(i.body)&&(i.body=JSON.parse(i.body)),this.dockerInitState||(this.dockerInitState=!0,this.dockerInit&&this.dockerInit()),this.router(i,n,function(e){return e?(console.log("index.js:89"+e),void n.status(500).json({message:"Application Error: "+e.message})):void n.status(404).json({message:"Not Found"})})}}]),e}();t.Cloudhopper=a,t.Response=r},function(e,t){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),s=(new Date).getTime(),i=0,r=function(){function e(t,n){o(this,e),this.initTime=(new Date).getTime(),this.context=t,this.callback=n,this.responseBody="",this.headers={"content-type":"text/html"},this.statusCode=200,this.isSent=!1}return n(e,[{key:"status",value:function(e){return this.statusCode=parseInt(e),this}},{key:"json",value:function(e){this.responseBody=JSON.stringify(e),this.headers["content-type"]="application/json",this.end()}},{key:"error",value:function(e){this.statusCode=500,this.responseBody=JSON.stringify({message:"Error: "+e.message}),this.end()}},{key:"redirect",value:function(e,t){this.statusCode=parseInt(e),this.headers.Location=t,this.end()}},{key:"send",value:function(e){this.responseBody=e,this.end()}},{key:"end",value:function(){if(!this.isSent){this.isSent=!0,this.context.callbackWaitsForEmptyEventLoop=!1,this.headers.dockerInitTime=s,this.headers.dockerCounter=++i,this.headers.Server="CloudHopper 1.0",this.headers.requestTime=(new Date).getTime()-this.initTime;var e={statusCode:this.statusCode,headers:this.headers,body:this.responseBody};this.callback(null,e)}}}]),e}();e.exports=r}])});